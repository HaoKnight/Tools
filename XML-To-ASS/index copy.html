<!DOCTYPE html>
<html lang="zh-cn">
  <!-- 头部区域：包含页面元数据、样式表和脚本 -->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>bilibili ASS 弹幕在线转换</title>

    <!-- SEO 关键词和描述 -->
    <meta name="keywords" content="bilibili, 哔哩哔哩, 弹幕, danmaku, 转换" />
    <meta
      name="description"
      content="bilibili ASS Danmaku Converter，在线将 bilibili 弹幕 XML 文件转换为 ASS 字幕格式"
    />

    <style>
      /* --- 全局样式重置 --- */
      html,
      body {
        font-family: "Microsoft YaHei", Helvetica, Arial, sans-serif; /* 字体设置 */
        font-size: 16px;
        font-weight: normal;
        line-height: 20px;
        margin: 0;
        padding: 0;
      }

      body {
        background: #fdfdfd; /* 背景颜色 */
        padding-bottom: 40px;
      }

      /* --- 布局容器 --- */
      #main-body {
        width: 900px; /* 内容区域宽度 */
        margin: 0 auto; /* 水平居中 */
      }

      /* --- 标题样式 --- */
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 0;
        padding: 0;
        font-size: 100%;
        font-weight: normal;
      }

      a,
      a:hover,
      a:active,
      a:visited {
        text-decoration: none;
        color: #f25d8e;
        outline: none;
      }

      a img {
        border: none;
      }

      h1 {
        color: #d95e7f; /* B站粉色 */
        font-size: 40px;
        line-height: 60px;
        margin: 40px 0 20px 0;
        padding: 0;
        font-weight: bold;
      }

      header {
        display: flex;
        flex-direction: column; /* 垂直排布方便整体居中 */
        height: 200px;
        align-items: center; /* 垂直居中 */
        justify-content: center; /* 水平居中 */
        gap: 20px; /* 元素间距 */
      }

      /* 上侧介绍框 */
      #intro {
        border: 2px solid #f25d8e;
        /* float: left;  移除浮动 */
        height: 80px;
        line-height: 40px;
        font-size: 20px;
        padding: 18px;
        background: #f8f8f8;
        border-radius: 8px; /* 圆角 */
        color: #333;
        text-align: center; /* 文字居中 */
      }

      #intro strong {
        color: #000;
        font-weight: normal;
      }

      /* 右侧按钮区域 */
      #side-buttons {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        padding: 0;
        text-align: center; /* 文字居中 */
      }

      /* 在线转换按钮 */
      #convert {
        background: #f25d8e;
        color: #fff;
        font-size: 32px;
        line-height: 50px;
        padding: 10px 50px;
        width: 300px;
        border-radius: 8px; /* 圆角 */
        /* clear: both; */
        display: block;
        /* float: right; 移除浮动 */
        text-align: center;
        cursor: pointer; /* 鼠标悬停手型 */
        margin: 0 auto; /* 自身居中 */
      }

      #convert:hover {
        background: #f32b6d; /* 悬停加深颜色 */
      }

      h3 {
        font-size: 24px;
        font-weight: bold;
        border-bottom: 2px #ccc solid; /* 底部下划线 */
        padding: 10px 20px;
        margin: 20px 0 10px;
      }

      /* 标题前的粉色装饰块 */
      h3::before {
        background: #f32b6d;
        content: "";
        display: block;
        float: left;
        height: 20px;
        left: -20px;
        position: relative;
        width: 10px;
      }

      .in {
        padding: 5px 2em;
        border: 4px;
      }

      .p {
        margin: 0.5em 0;
      }
    </style>

    <!-- 引入核心逻辑脚本 (复用 UserScript) -->
    <script src="bilibili_ASS_Danmaku_Downloader.user.js"></script>

    <!-- 
      解析文件内容的辅助函数：
      清理控制字符后调用 parseXML 进行处理 
    -->
    <script>
      var parseFile = function (content) {
        // 移除 ASCII 控制字符 (0x00-0x08, 0x0b, 0x0c, 0x0e-0x1f)
        content = content.replace(
          /[\u0000-\u0008\u000b\u000c\u000e-\u001f]/g,
          ""
        );
        return parseXML(content);
      };
    </script>

    <!-- 页面通用交互脚本 -->
    <script src="common.js"></script>
  </head>
  <body>
    <!-- 页面主体容器 -->
    <div id="main-body">
      <h1>bilibili ASS 弹幕在线转换</h1>

      <header>
        <!-- 功能简介 -->
        <div id="intro">
          将 XML 弹幕文件转换为 ASS 格式<br />
          兼容 libass 和 VSFilter 的 ASS 格式解析器<br />
        </div>

        <!-- 操作按钮区域 -->
        <div id="side-buttons">
          <label title="上传 XML 文件在线转换">
            <span id="convert">在线转换</span>
            <!-- 隐藏的文件上传输入框 -->
            <input id="upload" style="display: none" type="file" />
          </label>
        </div>
      </header>

      <!-- 主要功能区 -->
      <h3>在线转换</h3>
      <div class="in">
        <div class="p">
          您可以点击上方的在线转换按钮上传 XML 文件将其转换为 ASS
          字幕文件。转换无需安装脚本或任何扩展。
        </div>
      </div>

      <!-- 底部链接 -->
      <h3>相关脚本</h3>
      <div class="in">
        <div class="p">
          更多脚本参考：<a href="https://knight-tools.de5.net/">Knight-Tools</a>
        </div>
      </div>
    </div>
  </body>
</html>
